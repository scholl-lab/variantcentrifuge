---
milestone: v0.15.0
audited: 2026-02-22T21:30:00Z
status: tech_debt
scores:
  requirements: 47/47
  phases: 10/10
  integration: 7/8
  flows: 7/8
gaps: []
tech_debt:
  - phase: 20-r-skat-backend
    items:
      - "RSKATTest missing explicit `parallel_safe: bool = False` class attribute (behavioral correct via getattr default)"
  - phase: 22-acat-o-and-diagnostics
    items:
      - "No distinct skat_o_p_value column when skat_method=SKATO — skat_p_value used for all SKAT methods (spec vs implementation naming mismatch)"
      - "lambda_gc.tsv filename vs ROADMAP criterion specifying lambda_gc.txt (typo in criterion)"
      - "Fisher exact test lambda_GC ~0.85 on null (inherently conservative — criterion [0.95, 1.05] inapplicable to Fisher)"
  - phase: 24-pure-python-coast-backend
    items:
      - "R golden values for COAST comparison not generated — tolerance tests compare Python-vs-Python, not Python-vs-R (requires R + AllelicSeries to resolve)"
  - phase: 27-association-performance-optimizations
    items:
      - "RSKATTest missing explicit `parallel_safe = False` attribute (same as Phase 20 item)"
  - cross-phase:
    items:
      - "`--pca-tool akt` does not execute AKT in classic pipeline (PCAComputationStage registered in stage registry but not in pipeline.py build_pipeline_stages()) — works in stage-based pipeline only"
      - "`skat_method` has no CLI arg — configurable only via JSON config"
      - "`min_cases`, `max_case_control_ratio`, `min_case_carriers` diagnostic thresholds have no CLI args — JSON config only"
---

# v0.15.0 Milestone Audit: Modular Rare Variant Association Framework

**Audited:** 2026-02-22
**Status:** Tech Debt (no critical blockers; accumulated deferred items)

## Summary

| Category | Score | Details |
|----------|-------|---------|
| Requirements | **47/47** | All v1 requirements marked Complete |
| Phases | **10/10** | All phases verified (7 passed, 3 gaps_found — all gaps resolved or non-critical) |
| Integration | **7/8** | 1 broken flow: `--pca-tool akt` in classic pipeline |
| E2E Flows | **7/8** | 7 complete, 1 partial (AKT PCA in classic pipeline) |
| Unit Tests | **1542 passed** | 0 failures, 47 warnings |

## Requirements Coverage

All 47 v1 requirements from REQUIREMENTS.md are satisfied:

| Group | Requirements | Status |
|-------|-------------|--------|
| Core Framework | CORE-01 through CORE-08 | 8/8 Complete |
| Covariate System | COV-01 through COV-04 | 4/4 Complete |
| Burden Tests | BURDEN-01 through BURDEN-03 | 3/3 Complete |
| Variant Weights | WEIGHT-01 through WEIGHT-05 | 5/5 Complete |
| SKAT/SKAT-O | SKAT-01 through SKAT-10 | 10/10 Complete |
| Omnibus Tests | OMNI-01 through OMNI-03 | 3/3 Complete |
| Diagnostics | DIAG-01 through DIAG-06 | 6/6 Complete |
| PCA Integration | PCA-01 through PCA-04 | 4/4 Complete |
| Allelic Series | SERIES-01, SERIES-02 | 2/2 Complete |
| Configuration | CONFIG-01, CONFIG-02 | 2/2 Complete |

## Phase Verification Summary

| Phase | Name | Status | Score | Notes |
|-------|------|--------|-------|-------|
| 18 | Foundation — Core Abstractions and Fisher Refactor | passed | 10/10 | Bit-identical Fisher parity confirmed |
| 19 | Covariate System and Burden Tests | passed | 5/5 | Beta+SE output, statsmodels-validated |
| 20 | R SKAT Backend | gaps_found | 4/5 | Python fallback absent (resolved by Phase 21) |
| 21 | Pure Python SKAT Backend | passed | 5/5 | GCKD cohort validated; R parity confirmed |
| 22 | ACAT-O and Diagnostics | gaps_found | 3/5 | Naming/criterion mismatches (non-critical) |
| 23 | PCA, Functional Weights, COAST, JSON Config | passed | 18/18 | All 4 sub-features verified |
| 24 | Pure Python COAST Backend | gaps_found | 4/5 | R golden values not generated |
| 25 | Python Default Backends and Quick Wins | passed | 9/9 | GCKD real-data validated |
| 26 | Association Testing Documentation | passed | 14/14 | 843-line guide, full cross-references |
| 27 | Association Performance Optimizations | passed | 11/11 | GL quadrature + ProcessPoolExecutor |

## Cross-Phase Integration

### Working Wiring (34 connections verified)

- **Engine → Tests:** AssociationEngine registry correctly routes to Fisher, LogisticBurden, LinearBurden, PurePythonSKAT, PurePythonCOAST
- **Genotype matrix → SKAT/COAST:** build_genotype_matrix() output consumed by all regression-based tests
- **Covariates → PCA merge → burden/SKAT:** load_covariates() → merge_pca_covariates() → covariate_matrix flows correctly
- **Weights → burden/SKAT:** get_weights() dispatch (beta/uniform/cadd/revel/combined) wired through to all test classes
- **ACAT-V → ACAT-O:** PurePythonSKATTest stores acat_v_p in extra dict → engine reads it → feeds compute_acat_o()
- **Davies → saddlepoint → Liu:** Three-tier fallback chain intact; GL quadrature replaces adaptive quad in SKAT-O
- **Parallel → sequential fallback:** all_parallel_safe check works; R backends correctly prevent parallel dispatch
- **CLI → cfg → AssociationConfig → tests:** Complete propagation for all 16 CLI args
- **JSON config → AssociationConfig:** "association" section parsed with CLI > JSON > default precedence
- **Backward compatibility:** --perform-gene-burden without --perform-association produces zero behavioral change

### Integration Issue

**`--pca-tool akt` in classic pipeline:** PCAComputationStage is registered in the stage registry (works in `--use-new-pipeline` stage-based pipeline) but not appended in `pipeline.py:build_pipeline_stages()`. When using the classic pipeline (default), `--pca-tool akt` silently does nothing — AKT never executes, no PCA file is produced, and PCA merge is skipped. The `--pca-file` flag (pre-computed file) works correctly in both pipeline modes.

**Severity:** Low. The stage-based pipeline handles this correctly. The classic pipeline path is the legacy path. The `--pca-file` workaround is fully functional.

## E2E Flow Verification

| Flow | Status | Notes |
|------|--------|-------|
| Fisher-only (`--association-tests fisher`) | Complete | Bit-identical to --perform-gene-burden |
| Full association (fisher + burden + skat) | Complete | ACAT-O combines, FDR corrected, diagnostics written |
| SKAT backend selection (python/r/auto) | Complete | Python default, R deprecated with warning |
| COAST backend selection (python/r/auto) | Complete | Python default, R deprecated with warning |
| PCA integration (`--pca-file`) | Complete | PCs merged as covariates correctly |
| PCA computation (`--pca-tool akt`) | **Partial** | Works in stage-based pipeline only; classic pipeline silently skips |
| Parallel execution (`--association-workers`) | Complete | ProcessPoolExecutor with sequential fallback |
| JSON config | Complete | All options applied, CLI overrides JSON |
| Backward compatibility | Complete | --perform-gene-burden unchanged |

## Tech Debt

### Phase 22: Specification vs Implementation Mismatches

1. **skat_o_p_value column naming:** DIAG-01 specifies `skat_o_p` as a distinct column, but implementation uses `skat_p_value` for all SKAT methods (SKAT, SKATO, Burden). The p-value IS computed and stored; it's a naming convention difference. SKAT-O mode is selected via `skat_method` config, not a separate test registration.

2. **lambda_gc.tsv vs .txt:** ROADMAP criterion says `lambda_gc.txt`; implementation creates `lambda_gc.tsv`. The CONTEXT.md design decision explicitly chose `.tsv`. This is a criterion typo.

3. **Fisher lambda_GC calibration:** ROADMAP criterion #5 states lambda_GC should fall in [0.95, 1.05] on permuted null. Fisher's exact test is inherently conservative (sub-uniform p-values), yielding lambda_GC ~0.85. The criterion applies only to score-based tests (burden, SKAT), not Fisher. Test suite uses [0.85, 1.15] tolerance on uniform p-values, which is appropriate.

### Phase 24: R Golden Values Pending

COAST Python-vs-R comparison tests compare Python output against itself (self-consistency), not against R AllelicSeries::COAST() reference values. The R golden script (`scripts/generate_coast_golden.R`) is written and ready but has not been executed. Requires R + AllelicSeries package to generate the reference values.

### Cross-Phase: Classic Pipeline Gaps

1. **PCAComputationStage not in classic pipeline** — only affects `--pca-tool akt` users on classic pipeline. Workaround: use `--pca-file` or `--use-new-pipeline`.

2. **JSON-only config fields** — `skat_method`, `min_cases`, `max_case_control_ratio`, `min_case_carriers` have no CLI args. Only configurable via JSON config. Reasonable defaults apply without configuration.

### Phase 20/27: RSKATTest Attribute

RSKATTest class lacks explicit `parallel_safe: bool = False` attribute. The engine's `getattr(test, "parallel_safe", False)` default handles this correctly at runtime. Docstring says it should be declared but code omits it.

## Error Handling Chains

| Chain | Status |
|-------|--------|
| R absent → Python fallback | Working: `get_skat_backend("auto")` returns PythonSKATBackend directly |
| matplotlib absent → skip QQ plot | Working: ImportError caught, INFO logged, pipeline continues |
| Davies C ext absent → saddlepoint → Liu | Working: _DAVIES_AVAILABLE flag checked, graceful fallback |
| AKT not in PATH → ToolNotFoundError | Working: Hard error raised (not silent skip) |

## Real-Data Validation

GCKD cohort (5,125 samples: 235 PKD cases, 4,889 controls) validated with Python default backend:
- PKD1: Fisher p=4.7e-39, SKAT p=3.47e-17, ACAT-V p=1.42e-12
- PKD2: Fisher p=7.6e-20, SKAT p=1.52e-26, ACAT-V p=1.52e-09
- COL4A5: Fisher NS, SKAT p=0.9999955, ACAT-V p=0.000299
- Pipeline completed in 140s, 386 MB peak memory

---

*Audited: 2026-02-22*
*Auditor: Claude (gsd-audit-milestone orchestrator + gsd-integration-checker)*
