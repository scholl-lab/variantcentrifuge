---
milestone: v0.15.0
audited: 2026-02-23T09:00:00Z
status: tech_debt
scores:
  requirements: 47/47
  phases: 12/12
  integration: 8/9
  flows: 8/9
gaps: []
tech_debt:
  - phase: 22-acat-o-and-diagnostics
    items:
      - "No distinct skat_o_p_value column when skat_method=SKATO — skat_p_value used for all SKAT methods (spec vs implementation naming mismatch)"
      - "Fisher exact test lambda_GC ~0.85 on null (inherently conservative — ROADMAP criterion [0.95, 1.05] inapplicable to Fisher)"
  - phase: 24-pure-python-coast-backend
    items:
      - "R golden values for COAST comparison not generated — tolerance tests compare Python-vs-Python, not Python-vs-R (requires R + AllelicSeries to resolve)"
  - phase: 29-classic-pipeline-deprecation-and-removal
    items:
      - "Two internal 'refactored_pipeline' strings remain in checkpoint fallback defaults (pipeline.py:509, runner.py:119) — unreachable in normal operation"
  - cross-phase:
    items:
      - "PCAComputationStage registered in stage_registry but not imported/added in pipeline.py:build_pipeline_stages() — --pca-tool akt silently does nothing"
      - "create_stages_from_config() does not map perform_association or perform_gene_burden — programmatic/Snakemake callers cannot trigger association analysis via config dict (primary CLI path unaffected)"
---

# v0.15.0 Milestone Audit: Modular Rare Variant Association Framework

**Audited:** 2026-02-23 (re-audit after Phases 28-29 completion)
**Previous audit:** 2026-02-22 (pre-Phase 28/29)
**Status:** Tech Debt (no critical blockers; accumulated deferred items)

## Summary

| Category | Score | Details |
|----------|-------|---------|
| Requirements | **47/47** | All v1 requirements marked Complete |
| Phases | **12/12** | All phases verified (9 passed, 3 gaps_found — all gaps resolved or non-critical) |
| Integration | **8/9** | 1 unwired stage: PCAComputationStage not in pipeline.py |
| E2E Flows | **8/9** | 8 complete, 1 broken (`--pca-tool akt`) |
| Unit Tests | **2001 passed** | 0 failures, 3 skipped (missing fixtures) |

### Changes Since Previous Audit (2026-02-22)

| Item | Previous Status | Current Status | Resolved By |
|------|----------------|----------------|-------------|
| RSKATTest missing `parallel_safe` attribute | Tech debt | **Resolved** | Phase 28 (skat_r.py:82) |
| `skat_method` has no CLI arg | Tech debt | **Resolved** | Phase 28 (`--skat-method`) |
| `min_cases` etc. have no CLI args | Tech debt | **Resolved** | Phase 28 (`--min-cases`, `--max-case-control-ratio`, `--min-case-carriers`) |
| lambda_gc.tsv vs .txt typo in ROADMAP | Tech debt | **Resolved** | Phase 28 (ROADMAP already correct) |
| `run_refactored_pipeline` naming | Not audited | **Resolved** | Phase 29 (renamed to `run_pipeline`) |
| `--use-new-pipeline` phantom flag | Not audited | **Resolved** | Phase 29 (all references removed) |
| CLAUDE.md/README "classic pipeline" language | Not audited | **Resolved** | Phase 29 (updated) |

## Requirements Coverage

All 47 v1 requirements from REQUIREMENTS.md are satisfied:

| Group | Requirements | Status |
|-------|-------------|--------|
| Core Framework | CORE-01 through CORE-08 | 8/8 Complete |
| Covariate System | COV-01 through COV-04 | 4/4 Complete |
| Burden Tests | BURDEN-01 through BURDEN-03 | 3/3 Complete |
| Variant Weights | WEIGHT-01 through WEIGHT-05 | 5/5 Complete |
| SKAT/SKAT-O | SKAT-01 through SKAT-10 | 10/10 Complete |
| Omnibus Tests | OMNI-01 through OMNI-03 | 3/3 Complete |
| Diagnostics | DIAG-01 through DIAG-06 | 6/6 Complete |
| PCA Integration | PCA-01 through PCA-04 | 4/4 Complete |
| Allelic Series | SERIES-01, SERIES-02 | 2/2 Complete |
| Configuration | CONFIG-01, CONFIG-02 | 2/2 Complete |

## Phase Verification Summary

| Phase | Name | Status | Score | Notes |
|-------|------|--------|-------|-------|
| 18 | Foundation — Core Abstractions and Fisher Refactor | passed | 10/10 | Bit-identical Fisher parity confirmed |
| 19 | Covariate System and Burden Tests | passed | 5/5 | Beta+SE output, statsmodels-validated |
| 20 | R SKAT Backend | gaps_found | 4/5 | Python fallback absent (resolved by Phase 21) |
| 21 | Pure Python SKAT Backend | passed | 5/5 | GCKD cohort validated; R parity confirmed |
| 22 | ACAT-O and Diagnostics | gaps_found | 3/5 | Naming/criterion mismatches (non-critical) |
| 23 | PCA, Functional Weights, COAST, JSON Config | passed | 18/18 | All 4 sub-features verified |
| 24 | Pure Python COAST Backend | gaps_found | 4/5 | R golden values not generated |
| 25 | Python Default Backends and Quick Wins | passed | 9/9 | GCKD real-data validated |
| 26 | Association Testing Documentation | passed | 14/14 | 843-line guide, full cross-references |
| 27 | Association Performance Optimizations | passed | 11/11 | GL quadrature + ProcessPoolExecutor |
| 28 | Tech Debt Cleanup | passed | 5/5 | RSKATTest, CLI args, ROADMAP fix |
| 29 | Classic Pipeline Deprecation and Removal | passed | 5/5 | run_pipeline rename, docs cleanup |

## Cross-Phase Integration

### Working Wiring (18 key connections verified)

- **Engine -> Tests:** AssociationEngine registry correctly routes to Fisher, LogisticBurden, LinearBurden, PurePythonSKAT, PurePythonCOAST (and R backends via deprecation path)
- **Genotype matrix -> SKAT/COAST:** build_genotype_matrix() output consumed by all regression-based tests
- **Covariates -> PCA merge -> burden/SKAT:** load_covariates() -> merge_pca_covariates() -> covariate_matrix flows correctly
- **Weights -> burden/SKAT:** get_weights() dispatch (beta/uniform/cadd/revel/combined) wired through to all test classes
- **ACAT-V -> ACAT-O:** PurePythonSKATTest stores acat_v_p in extra dict -> engine reads it -> feeds compute_acat_o()
- **Davies -> saddlepoint -> Liu:** Three-tier fallback chain intact; GL quadrature replaces adaptive quad in SKAT-O
- **Parallel -> sequential fallback:** all_parallel_safe check works; R backends correctly prevent parallel dispatch
- **CLI -> cfg -> AssociationConfig -> tests:** Complete propagation for all 20 CLI args (16 original + 4 from Phase 28)
- **JSON config -> AssociationConfig:** "association" section parsed with CLI > JSON > default precedence
- **Backward compatibility:** --perform-gene-burden without --perform-association produces zero behavioral change
- **Pipeline entry:** cli.py -> run_pipeline() -> PipelineRunner (clean naming, no "refactored" in public API)

### Integration Issues

**1. `PCAComputationStage` not wired in `pipeline.py`**

`PCAComputationStage` is defined in `processing_stages.py:2075` and registered in `stage_registry.py:481`, but `pipeline.py:build_pipeline_stages()` never imports or appends it. When `--pca-tool akt` is specified, AKT never executes, no PCA file is produced, and PCA merge is silently skipped.

**Severity:** Low-Medium. The `--pca-file` workaround (pre-computed PCA) is fully functional. The `--pca-tool akt` feature is documented in the guide but cannot actually execute.

**2. `create_stages_from_config()` missing association mapping**

`pipeline.py:create_stages_from_config()` does not set `args.perform_association` or `args.perform_gene_burden` from the config dict. Programmatic callers (e.g., Snakemake workflows) cannot trigger association analysis via config dict. The primary CLI path (`main()` -> `run_pipeline(refactored_args)`) is unaffected because argparse correctly sets the attributes.

**Severity:** Low. Only affects programmatic API usage, not CLI users.

## E2E Flow Verification

| Flow | Status | Notes |
|------|--------|-------|
| Fisher-only (`--association-tests fisher`) | Complete | Bit-identical to --perform-gene-burden |
| Full association (fisher + burden + skat) | Complete | ACAT-O combines, FDR corrected, diagnostics written |
| SKAT backend selection (python/r/auto) | Complete | Python default, R deprecated with warning |
| COAST backend selection (python/r/auto) | Complete | Python default, R deprecated with warning |
| PCA integration (`--pca-file`) | Complete | PCs merged as covariates correctly |
| PCA computation (`--pca-tool akt`) | **Broken** | PCAComputationStage not added to pipeline stages |
| Parallel execution (`--association-workers`) | Complete | ProcessPoolExecutor with sequential fallback |
| JSON config | Complete | All options applied, CLI overrides JSON |
| Backward compatibility | Complete | --perform-gene-burden unchanged |

## Remaining Tech Debt

### Phase 22: Specification vs Implementation Mismatches

1. **skat_o_p_value column naming:** DIAG-01 specifies `skat_o_p` as a distinct column, but implementation uses `skat_p_value` for all SKAT methods (SKAT, SKATO, Burden). The p-value IS computed and stored; it's a naming convention difference. The `skat_method` extra column indicates which method was used.

2. **Fisher lambda_GC calibration:** ROADMAP criterion #5 states lambda_GC should fall in [0.95, 1.05] on permuted null. Fisher's exact test is inherently conservative (sub-uniform p-values), yielding lambda_GC ~0.85. The criterion applies only to score-based tests (burden, SKAT), not Fisher. Test suite uses [0.85, 1.15] tolerance on uniform p-values, which is appropriate.

### Phase 24: R Golden Values Pending

COAST Python-vs-R comparison tests compare Python output against itself (self-consistency), not against R AllelicSeries::COAST() reference values. The R golden script (`scripts/generate_coast_golden.R`) is written and ready but has not been executed. Requires R + AllelicSeries package to generate the reference values.

### Phase 29: Internal Checkpoint Strings

Two internal `"refactored_pipeline"` strings remain as checkpoint fallback defaults (`pipeline.py:509`, `runner.py:119`). These are unreachable in normal operation — `cli.py` always sets `cfg["pipeline_version"] = __version__` first. They exist as compatibility guards for malformed state files.

### Cross-Phase: Pipeline Wiring

1. **PCAComputationStage not in pipeline.py** — `--pca-tool akt` silently does nothing. Workaround: use `--pca-file` with pre-computed PCA.

2. **create_stages_from_config() gap** — Programmatic callers cannot trigger association analysis via config dict. Primary CLI path unaffected.

## Error Handling Chains

| Chain | Status |
|-------|--------|
| R absent -> Python fallback | Working: `get_skat_backend("auto")` returns PythonSKATBackend directly |
| matplotlib absent -> skip QQ plot | Working: ImportError caught, INFO logged, pipeline continues |
| Davies C ext absent -> saddlepoint -> Liu | Working: _DAVIES_AVAILABLE flag checked, graceful fallback |
| AKT not in PATH -> ToolNotFoundError | Working: Hard error raised (not silent skip) |
| Firth fallback on logistic convergence | Working: penalized regression with warning code |
| R deprecation warning on --skat-backend r | Working: DeprecationWarning with v0.17.0 removal message |

## Real-Data Validation

GCKD cohort (5,125 samples: 235 PKD cases, 4,889 controls) validated with Python default backend:
- PKD1: Fisher p=4.7e-39, SKAT p=3.47e-17, ACAT-V p=1.42e-12
- PKD2: Fisher p=7.6e-20, SKAT p=1.52e-26, ACAT-V p=1.52e-09
- COL4A5: Fisher NS, SKAT p=0.9999955, ACAT-V p=0.000299
- Pipeline completed in 140s, 386 MB peak memory
- 2001 unit tests passing, 0 failures

---

*Audited: 2026-02-23 (re-audit after Phases 28-29)*
*Previous audit: 2026-02-22*
*Auditor: Claude (gsd-audit-milestone orchestrator + gsd-integration-checker)*
