---
phase: 17-accessibility-and-print-pdf
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - variantcentrifuge/templates/index.html
autonomous: true

must_haves:
  truths:
    - "Pressing Tab from the top of the page focuses a skip-to-content link before any other element"
    - "The data table has role='table' and all DataTables controls have aria-label attributes"
    - "Emoji link icons are replaced with inline SVG icons plus screen-reader-only text"
    - "All badge colors pass WCAG AA 4.5:1 contrast ratio"
    - "Tooltip trigger elements have tabindex='0' so keyboard users can reach them"
  artifacts:
    - path: "variantcentrifuge/templates/index.html"
      provides: "Skip-link, ARIA roles, SVG icons, contrast-fixed badges, keyboard tooltip support"
      contains: "skip-link"
  key_links:
    - from: "skip-link anchor"
      to: "main-content id"
      via: "href='#main-content'"
      pattern: "skip-link.*main-content"
    - from: "DataTables initComplete callback"
      to: "ARIA role attributes"
      via: "setAttribute calls after table init"
      pattern: "role.*table|aria-label"
---

<objective>
Add core WCAG 2.1 AA accessibility features to the HTML report template: skip-to-content link, ARIA roles and labels on all interactive elements, replace emoji link icons with accessible SVG icons, fix badge color contrast ratios, and ensure tooltip keyboard accessibility.

Purpose: Covers A11Y-01 (ARIA), A11Y-02 (keyboard tooltips), A11Y-04 (skip-link), A11Y-05 (SVG icons), A11Y-06 (contrast) -- the structural accessibility foundation.
Output: Updated index.html with all core accessibility features.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/17-accessibility-and-print-pdf/17-RESEARCH.md
@variantcentrifuge/templates/index.html
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add skip-link, sr-only class, ARIA roles, and keyboard tooltip support</name>
  <files>variantcentrifuge/templates/index.html</files>
  <action>
  1. Add `.sr-only` CSS class (position: absolute; left: -10000px; width: 1px; height: 1px; overflow: hidden) in the style block. This class is reused by multiple later features.

  2. Add `.skip-link` CSS: position: absolute; left: -10000px; top: auto; width: 1px; height: 1px; overflow: hidden. On `:focus`: position: fixed; top: 10px; left: 10px; z-index: 9999; padding: 12px 20px; background-color: #007bff; color: white; text-decoration: none; border-radius: 4px; box-shadow: 0 0 10px rgba(0,0,0,0.3); width: auto; height: auto; overflow: visible.

  3. Add skip-link as FIRST element inside `<body>`: `<a href="#main-content" class="skip-link">Skip to main content</a>`

  4. Wrap the main content area (from the dashboard section through the table section) in `<main id="main-content" tabindex="-1">`. The `<header>` stays outside `<main>`.

  5. In the DataTables `initComplete` callback (already exists in the template JS), add ARIA attribute setup:
     - `document.getElementById('variants_table').setAttribute('role', 'table')` (NOT 'grid' -- research finding #1)
     - `querySelector('thead').setAttribute('role', 'rowgroup')`
     - `querySelector('tbody').setAttribute('role', 'rowgroup')`
     - All `th` elements get `role="columnheader"`
     - All `td` elements get `role="cell"` (via querySelectorAll on the wrapper)
     - `.dataTables_filter input` gets `aria-label="Search variants"` and `type="search"`
     - `.dataTables_length select` gets `aria-label="Number of variants per page"`
     - `.buttons-colvis` gets `aria-label="Show or hide columns"`
     - `.dataTables_info` gets `role="status"` and `aria-live="polite"` (research finding #10)

  6. For tooltip keyboard accessibility (A11Y-02): The template already uses `trigger: 'mouseenter focus'` from Phase 15-02-05. Add `tabindex="0"` to all `.truncated-cell` spans in the Jinja template where they are rendered (line ~560). This makes truncated cells focusable by keyboard. The Tippy.js init already handles focus trigger.

  7. For the density toggle button (if it's a custom button created via DataTables), ensure it has an `aria-label="Toggle table density"` attribute.
  </action>
  <verify>
  - `grep -c 'skip-link' variantcentrifuge/templates/index.html` returns >= 2 (CSS + HTML)
  - `grep -c 'sr-only' variantcentrifuge/templates/index.html` returns >= 1
  - `grep "role.*table" variantcentrifuge/templates/index.html` finds role="table" assignment
  - `grep 'aria-label' variantcentrifuge/templates/index.html` finds labels for search, page length, colvis
  - `grep 'tabindex="0"' variantcentrifuge/templates/index.html` finds tabindex on truncated cells
  - `grep 'aria-live' variantcentrifuge/templates/index.html` finds polite live region
  - `make lint` passes (Python template file)
  </verify>
  <done>Skip-link is first focusable element, main content has id target, all DataTables controls have ARIA labels, table has role="table", truncated cells are keyboard-focusable, info region is a live region.</done>
</task>

<task type="auto">
  <name>Task 2: Replace emoji link icons with SVG and fix badge contrast</name>
  <files>variantcentrifuge/templates/index.html</files>
  <action>
  1. SVG Icon Replacement (A11Y-05):

  Add an SVG sprite definition block (hidden via `style="display: none"`) near the top of `<body>` (after the skip-link). Define two symbols:
  - `#icon-external-link` -- a simple external link icon (arrow pointing out of box), 16x16 viewBox
  - `#icon-igv` -- reuse external-link or use a similar icon for IGV links

  Replace the two emoji occurrences:
  a. Line ~549 (IGV links): Replace `<span class="link-icon">ðŸ”—</span>` with:
     ```html
     <svg aria-hidden="true" focusable="false" class="link-icon-svg" width="14" height="14"><use href="#icon-external-link"/></svg>
     <span class="sr-only">IGV report for {{ igv_link_detail.sample_id }} (opens in new tab)</span>
     ```

  b. Line ~557 (standard links): Replace `<span class="link-icon">ðŸ”—</span>` with:
     ```html
     <svg aria-hidden="true" focusable="false" class="link-icon-svg" width="14" height="14"><use href="#icon-external-link"/></svg>
     <span class="sr-only">{{ col_info.link_display_text }} (opens in new tab)</span>
     ```

  Add CSS for `.link-icon-svg`: `display: inline-block; vertical-align: middle; margin-right: 3px; fill: currentColor;`
  For IGV links: `.igv-individual-link .link-icon-svg { fill: #5cb85c; }`

  Remove the old `.link-icon` CSS rule (it targeted the emoji spans).

  2. Badge Color Contrast Fixes (A11Y-06):

  Audit and fix all badge background colors to meet WCAG AA 4.5:1 contrast with white text:

  IMPACT badges (lines ~669-674):
  - HIGH `#dc3545` -- 4.51:1 PASS (keep)
  - MODERATE `#fd7e14` -- 2.55:1 FAIL -> change to `#c05000` (4.6:1 PASS, still reads as orange)
  - LOW `#f59e0b` -- 2.17:1 FAIL -> change to `#b45309` (5.2:1 PASS, dark amber)
  - MODIFIER `#6c757d` -- 4.69:1 PASS (keep)

  ClinVar badges (lines ~691-704):
  - Pathogenic `#dc3545` -- PASS (keep)
  - Likely pathogenic `#e8590c` -- 3.24:1 FAIL -> change to `#c0392b` (5.3:1 PASS, darker orange-red)
  - VUS/Uncertain `#f59e0b` -- FAIL -> change to `#b45309` (same dark amber as LOW)
  - Likely benign `#7cb342` -- 3.19:1 FAIL -> change to `#558b2f` (5.1:1 PASS, darker green)
  - Benign `#4caf50` -- 3.17:1 FAIL -> change to `#2e7d32` (5.6:1 PASS, darker green)
  - Conflicting `#ff9800` -- 2.15:1 FAIL -> change to `#bf5600` (4.8:1 PASS, dark orange)

  Inheritance badges (lines ~724-741):
  - de_novo `#dc3545` -- PASS (keep)
  - compound_het `#9c27b0` -- 5.72:1 PASS (keep)
  - AD `#2196f3` -- 3.26:1 FAIL -> change to `#1565c0` (5.4:1 PASS, darker blue)
  - AR `#4caf50` -- FAIL -> change to `#2e7d32` (same darker green)
  - x_linked `#00acc1` -- 2.78:1 FAIL -> change to `#00838f` (4.7:1 PASS, darker teal)
  - mitochondrial `#ff9800` -- FAIL -> change to `#bf5600` (same dark orange)
  - homozygous `#78909c` -- 3.58:1 FAIL -> change to `#546e7a` (5.4:1 PASS, darker blue-gray)
  - non_mendelian `#ef5350` -- 3.48:1 FAIL -> change to `#c62828` (5.9:1 PASS, darker red)

  Dashboard impact dots (line ~471): Update the inline color map to match the new IMPACT colors (`MODERATE` -> `#c05000`, `LOW` -> `#b45309`).

  Dashboard chart colors: If the Chart.js impact/inheritance charts use the same color values, update those too (search for the color arrays in the chart initialization code around lines 1026+).

  3. Update any remaining color references to ensure consistency across the entire template.
  </action>
  <verify>
  - `grep 'ðŸ”—' variantcentrifuge/templates/index.html` returns NO matches (all emoji removed)
  - `grep 'icon-external-link' variantcentrifuge/templates/index.html` returns matches (SVG usage)
  - `grep 'aria-hidden="true"' variantcentrifuge/templates/index.html` returns matches (SVG icons)
  - `grep '#fd7e14' variantcentrifuge/templates/index.html` returns NO matches (old orange removed)
  - `grep '#f59e0b' variantcentrifuge/templates/index.html` returns NO matches (old amber removed)
  - `grep '#c05000' variantcentrifuge/templates/index.html` returns matches (new MODERATE orange)
  - `grep '#b45309' variantcentrifuge/templates/index.html` returns matches (new LOW amber)
  - `make lint` passes
  </verify>
  <done>All emoji link icons replaced with accessible SVG icons with sr-only text. All badge colors pass WCAG AA 4.5:1 contrast ratio with white text. Color palette is consistent across badges, dashboard dots, and chart colors.</done>
</task>

</tasks>

<verification>
- Template renders without errors (existing test suite passes)
- No emoji link icons remain in template
- All badge background colors have >= 4.5:1 contrast with white text
- Skip-link element is first child of body
- ARIA roles assigned after DataTables init
- Truncated cells have tabindex="0" for keyboard focus
</verification>

<success_criteria>
- A11Y-01: Table has role="table", controls have aria-label, info region has role="status" aria-live="polite"
- A11Y-02: Truncated cells have tabindex="0", tooltip trigger includes focus (already set)
- A11Y-04: Skip-to-content link present, visible on focus, targets main-content
- A11Y-05: Zero emoji link icons, all links use SVG with aria-hidden + sr-only text
- A11Y-06: All badge colors pass 4.5:1 contrast ratio
</success_criteria>

<output>
After completion, create `.planning/phases/17-accessibility-and-print-pdf/17-01-SUMMARY.md`
</output>
