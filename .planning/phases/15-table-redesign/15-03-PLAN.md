---
phase: 15-table-redesign
plan: 03
type: execute
wave: 3
depends_on: ["15-02"]
files_modified:
  - tests/unit/test_html_report.py
  - tests/unit/test_html_report_assets.py
autonomous: true

must_haves:
  truths:
    - "Tests verify FixedColumns assets are vendored and loadable"
    - "Tests verify control column HTML exists in rendered output"
    - "Tests verify density CSS classes exist in template"
    - "Tests verify dark header styling exists"
    - "Tests verify Phase 15 JS functions exist in template"
  artifacts:
    - path: "tests/unit/test_html_report.py"
      provides: "Phase 15 template feature tests"
      contains: "test_phase15"
    - path: "tests/unit/test_html_report_assets.py"
      provides: "FixedColumns asset loading tests"
  key_links:
    - from: "tests/unit/test_html_report.py"
      to: "variantcentrifuge/templates/index.html"
      via: "rendered HTML assertions"
      pattern: "assert.*html"
---

<objective>
Add tests for all Phase 15 table redesign features: FixedColumns asset loading, control column, dark header CSS, density modes, detail panel, column intelligence, tooltip configuration.

Purpose: Prevent regressions on Phase 15 features as Phase 16-17 build on this foundation.
Output: Comprehensive test coverage for Phase 15 requirements.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/15-table-redesign/15-01-SUMMARY.md
@.planning/phases/15-table-redesign/15-02-SUMMARY.md
@variantcentrifuge/templates/index.html
@tests/unit/test_html_report.py
@tests/unit/test_html_report_assets.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add FixedColumns asset tests</name>
  <files>tests/unit/test_html_report_assets.py</files>
  <action>
Read the existing `tests/unit/test_html_report_assets.py` to understand the test pattern, then add tests for FixedColumns assets.

Add a new test class or extend the existing one with:

1. **test_fixedcolumns_js_asset_exists** -- Verify `variantcentrifuge/assets/js/fixedcolumns.min.js` exists and is non-empty
2. **test_fixedcolumns_css_asset_exists** -- Verify `variantcentrifuge/assets/css/fixedcolumns.dataTables.min.css` exists and is non-empty
3. **test_fixedcolumns_js_contains_extension** -- Verify the JS file contains "FixedColumns" or "fixedColumns" (not an HTML error page)
4. **test_fixedcolumns_css_contains_styles** -- Verify the CSS file contains "dtfc" (FixedColumns class prefix)
5. **test_load_assets_includes_fixedcolumns** -- Call `_load_assets()` and verify both `js/fixedcolumns.min` and `css/fixedcolumns.dataTables.min` are in the returned dict

Follow the existing test patterns (pytest markers, import style, assertion style).
  </action>
  <verify>
    - `pytest tests/unit/test_html_report_assets.py -x -q` passes
    - New tests appear in the test output
  </verify>
  <done>FixedColumns asset tests verify JS and CSS files exist, contain valid content, and are discoverable by _load_assets()</done>
</task>

<task type="auto">
  <name>Task 2: Add Phase 15 template feature tests</name>
  <files>tests/unit/test_html_report.py</files>
  <action>
Read the existing `tests/unit/test_html_report.py` to understand the test pattern (class-scoped fixtures for rendered HTML, string assertions).

Add a new test class `TestPhase15TableRedesign` (or extend existing Phase 14 pattern) with tests for:

**CSS/Styling tests (pattern-based, check template source):**

1. **test_dark_header_css** -- Template contains `#2c3e50` (dark header gradient color)
2. **test_zebra_striping_css** -- Template contains `nth-child(odd)` with background color
3. **test_density_mode_css** -- Template contains `.density-compact`, `.density-regular`, `.density-relaxed` CSS classes
4. **test_detail_panel_css** -- Template contains `.detail-panel` with grid layout
5. **test_chevron_css** -- Template contains `.dt-control .chevron` styling
6. **test_monospace_class_css** -- Template contains `.monospace` font-family rule
7. **test_fixedcolumns_shadow_css** -- Template contains `.dtfc-fixed-left` with box-shadow
8. **test_record_count_css** -- Template contains `.dt-info` with font-weight: 600

**JS behavior tests (pattern-based, check template source):**

9. **test_control_column_definition** -- Template contains `dt-control` in columnDefs and `defaultContent` with chevron
10. **test_fixedcolumns_config** -- Template contains `fixedColumns` with `left: 2`
11. **test_density_localstorage_init** -- Template contains `localStorage.getItem('variantTableDensity')`
12. **test_density_toggle_button** -- Template contains density button with `localStorage.setItem`
13. **test_format_child_row_function** -- Template contains `formatChildRow` function with category sections (Identifiers, Annotations, Scores, Links)
14. **test_child_row_click_handler** -- Template contains `table.on('click', 'tbody td.dt-control'` event handler
15. **test_column_index_shift** -- Template contains `index + 1` for targets (control column offset)
16. **test_tooltip_keyboard_trigger** -- Template contains `trigger: 'mouseenter focus'` in tippy config
17. **test_tooltip_touch_support** -- Template contains `touch:` config in tippy setup
18. **test_hgvs_truncation_render** -- Template contains HGVS render function with `substring(0, 30)` truncation
19. **test_middle_truncation_render** -- Template contains VAR_ID render with middle truncation pattern
20. **test_right_align_numeric** -- Template contains `dt-right` class assignment for score columns

**Rendered HTML tests (if class-scoped fixture available):**

21. **test_rendered_html_has_control_column_header** -- Rendered HTML contains empty `<th>` for control column as first header
22. **test_rendered_html_has_fixedcolumns_css** -- Rendered HTML contains `dtfc` styles (from inlined asset)
23. **test_rendered_html_has_fixedcolumns_js** -- Rendered HTML contains `FixedColumns` or `fixedColumns` in script

These tests follow the pattern established in Phase 14 (14-03): pattern-based testing of template code rather than runtime DOM verification. Use `Path(template_path).read_text()` for source checks, and the rendered HTML fixture for output checks.

Mark all tests with `@pytest.mark.unit`.
  </action>
  <verify>
    - `pytest tests/unit/test_html_report.py -x -q` passes (all tests including new ones)
    - `pytest tests/unit/test_html_report.py -k "phase15 or Phase15" -v` shows the new tests
    - `make test-fast` passes (no regressions)
  </verify>
  <done>Phase 15 tests cover: CSS styles (header, zebra, density, detail panel, chevron, monospace, FixedColumns shadow, record count), JS behavior (control column, FixedColumns config, density localStorage, child row handler, column index shift, tooltip config, truncation renders), and rendered HTML (control column header, inlined assets)</done>
</task>

</tasks>

<verification>
- All new tests pass: `pytest tests/unit/test_html_report.py tests/unit/test_html_report_assets.py -x -q`
- No regressions: `make test-fast` passes
- Tests cover all 10 TABLE requirements
</verification>

<success_criteria>
1. FixedColumns asset tests verify files exist, contain valid content, and are loadable
2. Template CSS tests verify dark header, zebra, density modes, detail panel, column classes
3. Template JS tests verify control column, FixedColumns config, density toggle, child rows, column intelligence
4. Rendered HTML tests verify control column header and inlined assets
5. All existing tests continue to pass
6. `make test-fast` passes with no regressions
</success_criteria>

<output>
After completion, create `.planning/phases/15-table-redesign/15-03-SUMMARY.md`
</output>
