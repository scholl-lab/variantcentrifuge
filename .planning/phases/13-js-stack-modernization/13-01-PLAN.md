---
phase: 13-js-stack-modernization
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - variantcentrifuge/assets/js/jquery.slim.min.js
  - variantcentrifuge/assets/js/datatables.min.js
  - variantcentrifuge/assets/js/datatables.buttons.min.js
  - variantcentrifuge/assets/js/buttons.colVis.min.js
  - variantcentrifuge/assets/js/chart.umd.min.js
  - variantcentrifuge/assets/js/chartjs-plugin-datalabels.min.js
  - variantcentrifuge/assets/js/tippy-bundle.umd.min.js
  - variantcentrifuge/assets/css/datatables.min.css
  - variantcentrifuge/assets/css/buttons.dataTables.min.css
  - variantcentrifuge/generate_html_report.py
autonomous: true

must_haves:
  truths:
    - "All JS/CSS library files exist in variantcentrifuge/assets/ and are valid minified files"
    - "generate_html_report.py reads asset files and passes them as template variables"
    - "Assets are included in the Python package build (hatchling)"
  artifacts:
    - path: "variantcentrifuge/assets/js/jquery.slim.min.js"
      provides: "jQuery slim (required by DataTables v2 internally)"
    - path: "variantcentrifuge/assets/js/datatables.min.js"
      provides: "DataTables v2 core"
    - path: "variantcentrifuge/assets/js/chart.umd.min.js"
      provides: "Chart.js v4 UMD bundle"
    - path: "variantcentrifuge/assets/js/tippy-bundle.umd.min.js"
      provides: "Tippy.js v6 with Popper.js bundled"
    - path: "variantcentrifuge/generate_html_report.py"
      provides: "Asset loading and template variable injection"
      contains: "assets_dir"
  key_links:
    - from: "variantcentrifuge/generate_html_report.py"
      to: "variantcentrifuge/assets/"
      via: "Path(__file__).parent / 'assets'"
      pattern: "assets.*read_text|assets.*open"
---

<objective>
Download and vendor all JS/CSS library files into variantcentrifuge/assets/, then update generate_html_report.py to load these files and pass their contents as Jinja2 template variables for inline embedding.

Purpose: Establish the asset infrastructure that the template rewrite (Plan 02) depends on. Separating asset acquisition from template work keeps each plan focused.
Output: Populated assets directory, updated Python report generator with asset loading.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@variantcentrifuge/generate_html_report.py
@pyproject.toml
</context>

<tasks>

<task type="auto">
  <name>Task 1: Download and vendor JS/CSS library files</name>
  <files>
    variantcentrifuge/assets/js/jquery.slim.min.js
    variantcentrifuge/assets/js/datatables.min.js
    variantcentrifuge/assets/js/datatables.buttons.min.js
    variantcentrifuge/assets/js/buttons.colVis.min.js
    variantcentrifuge/assets/js/chart.umd.min.js
    variantcentrifuge/assets/js/chartjs-plugin-datalabels.min.js
    variantcentrifuge/assets/js/tippy-bundle.umd.min.js
    variantcentrifuge/assets/css/datatables.min.css
    variantcentrifuge/assets/css/buttons.dataTables.min.css
  </files>
  <action>
    Create directory structure: variantcentrifuge/assets/js/ and variantcentrifuge/assets/css/

    Download these specific versions using curl/wget:

    JS files:
    - jQuery slim 3.7.1 minified (slim build, no ajax/effects): https://code.jquery.com/jquery-3.7.1.slim.min.js
    - DataTables 2.2.2: https://cdn.datatables.net/2.2.2/js/dataTables.min.js
    - DataTables Buttons 3.2.2: https://cdn.datatables.net/buttons/3.2.2/js/dataTables.buttons.min.js
    - Buttons ColVis 3.2.2: https://cdn.datatables.net/buttons/3.2.2/js/buttons.colVis.min.js
    - Chart.js 4.4.8 UMD: https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js
    - chartjs-plugin-datalabels 2.2.0: https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js
    - Tippy.js 6.3.7 bundle (includes Popper.js): https://unpkg.com/tippy.js@6.3.7/dist/tippy-bundle.umd.min.js

    CSS files:
    - DataTables 2.2.2: https://cdn.datatables.net/2.2.2/css/dataTables.dataTables.min.css -> save as datatables.min.css
    - DataTables Buttons 3.2.2: https://cdn.datatables.net/buttons/3.2.2/css/buttons.dataTables.min.css

    Also download Tippy.js default CSS theme:
    - https://unpkg.com/tippy.js@6.3.7/dist/tippy.css -> save as variantcentrifuge/assets/css/tippy.css

    IMPORTANT: If any URL fails (404, network error), try the closest available version from the same CDN. The exact patch version matters less than getting the right major.minor.

    Verify each file is non-empty and contains actual JavaScript/CSS (not an HTML error page). A quick check: the file should NOT start with "<!DOCTYPE" or "<html".
  </action>
  <verify>
    Run: `ls -la variantcentrifuge/assets/js/ variantcentrifuge/assets/css/` to confirm all files exist and have reasonable sizes (jQuery ~70KB, DataTables ~90KB, Chart.js ~65KB, Tippy ~25KB).
    Run: `head -c 100 variantcentrifuge/assets/js/chart.umd.min.js` to verify it's actual JS, not an error page.
  </verify>
  <done>All 10 asset files exist in variantcentrifuge/assets/ with correct content (JS/CSS, not error pages), sizes match expected ranges.</done>
</task>

<task type="auto">
  <name>Task 2: Update generate_html_report.py to load and inject assets</name>
  <files>
    variantcentrifuge/generate_html_report.py
  </files>
  <action>
    Modify generate_html_report.py to:

    1. Add an asset loading function that reads all files from variantcentrifuge/assets/js/ and variantcentrifuge/assets/css/:
       ```python
       def _load_assets() -> dict[str, str]:
           """Load vendored JS/CSS assets for inline embedding."""
           assets_dir = Path(__file__).parent / "assets"
           assets = {}
           for subdir in ("js", "css"):
               asset_path = assets_dir / subdir
               if asset_path.exists():
                   for f in sorted(asset_path.iterdir()):
                       if f.is_file():
                           assets[f.stem] = f.read_text(encoding="utf-8")
           return assets
       ```

    2. In generate_html_report(), call _load_assets() and pass the result to the template render:
       ```python
       assets = _load_assets()
       ```
       Then add `assets=assets` to the template.render() call.

    3. Keep ALL existing template variables (variants, summary, column_data, default_hidden_columns, generation_date, version) -- just ADD the assets variable.

    4. Do NOT change any other logic in the file. The template (Plan 02) will consume the assets variable.

    IMPORTANT: Keep the function signature and return type identical. Only add asset loading internally.
  </action>
  <verify>
    Run: `cd /mnt/c/development/scholl-lab/variantcentrifuge && python -c "from variantcentrifuge.generate_html_report import _load_assets; a = _load_assets(); print(f'Loaded {len(a)} assets: {list(a.keys())}')"` to confirm assets load correctly.
    Run: `make lint` to confirm no lint errors.
    Verify assets will be included in the built package: `cd /mnt/c/development/scholl-lab/variantcentrifuge && python -m build --wheel -o /tmp/vc-test-build 2>/dev/null && python -c "import zipfile, glob; whl=glob.glob('/tmp/vc-test-build/*.whl')[0]; names=[n for n in zipfile.ZipFile(whl).namelist() if 'assets/' in n]; print(f'Assets in wheel: {len(names)}'); assert len(names) >= 10, f'Expected >=10 asset files, got {len(names)}'"` â€” if this fails, add explicit package-data config to pyproject.toml.
  </verify>
  <done>generate_html_report.py loads all vendored assets and passes them to the Jinja2 template as an `assets` dict. Existing functionality unchanged. Lint passes.</done>
</task>

</tasks>

<verification>
- All 10 asset files exist in variantcentrifuge/assets/ (js/ and css/ subdirs)
- Asset files contain actual library code (not HTML error pages)
- _load_assets() returns a dict with all asset keys
- generate_html_report() passes assets to template.render()
- `make lint` passes
- Assets included in built wheel (verified via `python -m build`)
- Existing tests still pass: `pytest tests/unit/stages/test_output_stages.py -k html -x`
</verification>

<success_criteria>
1. variantcentrifuge/assets/js/ contains 7 JS files (jQuery slim, DataTables core + buttons + colvis, Chart.js, chartjs-plugin-datalabels, Tippy.js)
2. variantcentrifuge/assets/css/ contains 3 CSS files (DataTables, Buttons, Tippy)
3. generate_html_report.py loads assets and passes them to the template
4. All existing tests pass unchanged
</success_criteria>

<output>
After completion, create `.planning/phases/13-js-stack-modernization/13-01-SUMMARY.md`
</output>
