---
phase: 28-tech-debt-cleanup
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - variantcentrifuge/association/tests/skat_r.py
  - .planning/phases/22-acat-o-and-diagnostics/22-VERIFICATION.md
autonomous: true

must_haves:
  truths:
    - "RSKATTest declares parallel_safe as a class-level typed attribute"
    - "ROADMAP Phase 22 criterion 3 references lambda_gc.tsv (already correct)"
    - "Phase 22 VERIFICATION.md gap about lambda_gc filename is marked resolved"
  artifacts:
    - path: "variantcentrifuge/association/tests/skat_r.py"
      provides: "RSKATTest with explicit parallel_safe: bool = False class attribute"
      contains: "parallel_safe: bool = False"
    - path: ".planning/phases/22-acat-o-and-diagnostics/22-VERIFICATION.md"
      provides: "Updated verification with lambda_gc gap resolved"
      contains: "resolved"
  key_links:
    - from: "variantcentrifuge/association/tests/skat_r.py"
      to: "variantcentrifuge/association/engine.py"
      via: "getattr(test, 'parallel_safe', False)"
      pattern: "parallel_safe.*bool.*False"
---

<objective>
Add the missing `parallel_safe: bool = False` class attribute to RSKATTest and close the lambda_gc filename verification gap.

Purpose: RSKATTest is the only AssociationTest subclass without an explicit parallel_safe declaration. Adding it ensures consistency with all other test classes (FisherExactTest, LogisticBurdenTest, LinearBurdenTest, PurePythonSKATTest, COASTTest, PurePythonCOASTTest). The lambda_gc gap in 22-VERIFICATION.md is a documentation artifact -- the ROADMAP already says .tsv.

Output: Updated skat_r.py with class attribute; updated 22-VERIFICATION.md with gap resolved.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/28-tech-debt-cleanup/28-RESEARCH.md

Key references:
- RSKATTest class: variantcentrifuge/association/tests/skat_r.py (line 55, class body starts line 81)
- Pattern to follow: variantcentrifuge/association/tests/allelic_series.py line 277 (`parallel_safe: bool = False`)
- Engine usage: variantcentrifuge/association/engine.py line 355 (`getattr(test, "parallel_safe", False)`)
- 22-VERIFICATION.md: .planning/phases/22-acat-o-and-diagnostics/22-VERIFICATION.md (Gap 2 at line 124)
- ROADMAP criterion: .planning/ROADMAP.md line 168 (already says lambda_gc.tsv)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add parallel_safe class attribute to RSKATTest</name>
  <files>variantcentrifuge/association/tests/skat_r.py</files>
  <action>
  Add `parallel_safe: bool = False` as a class-level typed attribute in RSKATTest, placed between the closing `"""` of the class docstring (line 80) and `def __init__` (line 82).

  The line should be:
  ```python
  parallel_safe: bool = False  # rpy2 restriction: main thread only
  ```

  This matches the pattern used by every other AssociationTest subclass:
  - COASTTest in allelic_series.py: `parallel_safe: bool = False`
  - FisherExactTest in fisher.py: `parallel_safe: bool = True`
  - PurePythonSKATTest in skat_python.py: `parallel_safe: bool = True`

  Do NOT add it as an instance attribute in __init__. It must be a class-level attribute.
  </action>
  <verify>
  1. `grep -n "parallel_safe" variantcentrifuge/association/tests/skat_r.py` shows the attribute at class body level (before __init__)
  2. `python -c "from variantcentrifuge.association.tests.skat_r import RSKATTest; print(RSKATTest.parallel_safe)"` prints `False` (may fail if rpy2 not installed -- that's OK, verify via grep)
  3. `make ci-check` passes (existing tests unaffected)
  </verify>
  <done>RSKATTest has explicit `parallel_safe: bool = False` class attribute matching the pattern of all other AssociationTest subclasses.</done>
</task>

<task type="auto">
  <name>Task 2: Close lambda_gc verification gap</name>
  <files>.planning/phases/22-acat-o-and-diagnostics/22-VERIFICATION.md</files>
  <action>
  1. First, verify the ROADMAP at line 168 already says `lambda_gc.tsv` (not .txt). If it does, no ROADMAP change needed.

  2. Update `.planning/phases/22-acat-o-and-diagnostics/22-VERIFICATION.md`:
     - Find the gap about `lambda_gc.tsv vs lambda_gc.txt` (around line 19-26 and line 124)
     - Change its status from `failed` to `resolved`
     - Update the reason to: "ROADMAP criterion #3 now correctly says lambda_gc.tsv. Implementation creates lambda_gc.tsv. No mismatch."
     - In the summary table (line 56), change "PARTIAL" to "VERIFIED" for criterion 3
     - In the Gap 2 discussion (line 124), note resolution: "Resolved in Phase 28: ROADMAP criterion already says .tsv; gap was a documentation artifact."
  </action>
  <verify>
  1. `grep "lambda_gc.tsv" .planning/ROADMAP.md` confirms ROADMAP says .tsv
  2. `grep "resolved\|VERIFIED" .planning/phases/22-acat-o-and-diagnostics/22-VERIFICATION.md` shows gap is marked resolved
  </verify>
  <done>Phase 22 VERIFICATION.md lambda_gc gap is marked as resolved. ROADMAP confirmed correct (already says .tsv).</done>
</task>

</tasks>

<verification>
1. `grep -n "parallel_safe" variantcentrifuge/association/tests/skat_r.py` -- shows class-level attribute
2. `grep "lambda_gc.tsv" .planning/ROADMAP.md` -- confirms .tsv in ROADMAP
3. `make ci-check` -- all existing tests pass
</verification>

<success_criteria>
1. RSKATTest has explicit `parallel_safe: bool = False` class attribute (not instance attribute)
2. ROADMAP Phase 22 criterion 3 references `lambda_gc.tsv` (confirmed, no change needed)
3. Phase 22 VERIFICATION.md gap marked resolved
4. All existing tests pass (`make ci-check`)
</success_criteria>

<output>
After completion, create `.planning/phases/28-tech-debt-cleanup/28-01-SUMMARY.md`
</output>
