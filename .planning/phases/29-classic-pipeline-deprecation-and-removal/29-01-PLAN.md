---
phase: 29-classic-pipeline-deprecation-and-removal
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - variantcentrifuge/pipeline.py
  - variantcentrifuge/cli.py
  - tests/integration/test_pipeline_with_mocked_tools.py
  - tests/test_gene_list_integration.py
  - tests/unit/test_cli_debug_logging.py
autonomous: true

must_haves:
  truths:
    - "pipeline.py docstring and function names no longer reference 'refactored' or legacy pipeline"
    - "cli.py imports and calls run_pipeline (not run_refactored_pipeline)"
    - "All tests importing run_refactored_pipeline are updated to use run_pipeline"
    - "Pipeline behavior is identical before and after rename"
  artifacts:
    - path: "variantcentrifuge/pipeline.py"
      provides: "Stage-based pipeline with clean naming"
      contains: "def run_pipeline"
    - path: "variantcentrifuge/cli.py"
      provides: "CLI entry point importing run_pipeline"
      contains: "from .pipeline import run_pipeline"
  key_links:
    - from: "variantcentrifuge/cli.py"
      to: "variantcentrifuge/pipeline.py"
      via: "import run_pipeline"
      pattern: "from \\.pipeline import run_pipeline"
    - from: "tests/integration/test_pipeline_with_mocked_tools.py"
      to: "variantcentrifuge/pipeline.py"
      via: "import run_pipeline"
      pattern: "from variantcentrifuge\\.pipeline import.*run_pipeline"
---

<objective>
Clean up pipeline.py and cli.py naming to remove all "refactored" terminology, establishing pipeline.py as THE pipeline (not a refactored version of something else). Also remove the vestigial main() demo function from pipeline.py.

Purpose: pipeline.py IS the stage-based pipeline but still carries naming from when it was the "new" replacement. This plan removes that historical naming artifact.
Output: Clean pipeline.py with run_pipeline(), clean cli.py import, updated test imports.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/29-classic-pipeline-deprecation-and-removal/29-RESEARCH.md
@variantcentrifuge/pipeline.py
@variantcentrifuge/cli.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Rename pipeline.py functions and clean up docstrings</name>
  <files>
    variantcentrifuge/pipeline.py
    variantcentrifuge/cli.py
  </files>
  <action>
    In variantcentrifuge/pipeline.py:
    1. Replace the module docstring (lines 1-5) from "Refactored pipeline using the new Stage architecture. This module demonstrates how to use the refactored pipeline stages to replace the monolithic pipeline.py functionality." to something like "Stage-based pipeline orchestration. This module builds and runs the stage-based pipeline using PipelineRunner, PipelineContext, and registered Stage subclasses from pipeline_core/."
    2. Rename `run_refactored_pipeline` (line 369) to `run_pipeline`. Update its docstring to remove any "refactored" or "new" language.
    3. Remove the `main()` function (line 569 to end of file) entirely — it's a demo/test function that duplicates CLI functionality and is not called from anywhere in production code. Verify with grep first that nothing imports or calls `pipeline.main()`.
    4. Keep `build_pipeline_stages`, `create_stages_from_config`, and `check_scoring_requires_inheritance` unchanged — they have clean names already.

    In variantcentrifuge/cli.py:
    1. Line 12: Change `from .pipeline import run_refactored_pipeline` to `from .pipeline import run_pipeline`
    2. Line 1623: Change `run_refactored_pipeline(refactored_args)` to `run_pipeline(refactored_args)` (the variable name `refactored_args` is fine to keep — it's a local variable name, not user-facing)

    Do NOT rename the variable `refactored_args` in cli.py — that would touch many more lines for no user-facing benefit and risks introducing bugs.
  </action>
  <verify>
    Run: `python -c "from variantcentrifuge.pipeline import run_pipeline, build_pipeline_stages, create_stages_from_config"` — should succeed.
    Run: `grep -n "run_refactored_pipeline" variantcentrifuge/pipeline.py variantcentrifuge/cli.py` — should return nothing.
    Run: `grep -n "def main" variantcentrifuge/pipeline.py` — should return nothing.
  </verify>
  <done>pipeline.py exports run_pipeline (not run_refactored_pipeline); main() demo removed; cli.py imports and calls run_pipeline.</done>
</task>

<task type="auto">
  <name>Task 2: Update test imports referencing run_refactored_pipeline</name>
  <files>
    tests/integration/test_pipeline_with_mocked_tools.py
    tests/test_gene_list_integration.py
  </files>
  <action>
    In tests/integration/test_pipeline_with_mocked_tools.py:
    1. Line 15: Change `from variantcentrifuge.pipeline import build_pipeline_stages, run_refactored_pipeline` to `from variantcentrifuge.pipeline import build_pipeline_stages, run_pipeline`
    2. All call sites (lines ~225, 293, 344, 490, 624, 748): Change `run_refactored_pipeline(args)` to `run_pipeline(args)`

    In tests/test_gene_list_integration.py:
    1. Lines ~140-151: Update all references from `run_refactored_pipeline` to `run_pipeline`:
       - The mock function name: `mock_run_refactored_pipeline` -> `mock_run_pipeline`
       - The mock docstring
       - The mock target: `"variantcentrifuge.cli.run_refactored_pipeline"` -> `"variantcentrifuge.cli.run_pipeline"`

    In tests/unit/test_cli_debug_logging.py:
    1. Lines 13 and 76: Update `@patch("variantcentrifuge.cli.run_refactored_pipeline")` to `@patch("variantcentrifuge.cli.run_pipeline")`

    Run `grep -rn "run_refactored_pipeline" tests/ --include="*.py"` to find any other occurrences and update them too.
  </action>
  <verify>
    Run: `grep -rn "run_refactored_pipeline" tests/ --include="*.py"` — should return nothing.
    Run: `make test-fast` — all tests pass.
    Run: `make lint` — no lint errors.
  </verify>
  <done>All test files import and call run_pipeline; no references to run_refactored_pipeline remain in tests/; test suite passes.</done>
</task>

</tasks>

<verification>
1. `grep -rn "run_refactored_pipeline" variantcentrifuge/ tests/ --include="*.py"` returns nothing
2. `grep -n "def main" variantcentrifuge/pipeline.py` returns nothing
3. `python -c "from variantcentrifuge.pipeline import run_pipeline"` succeeds
4. `make test-fast` passes
5. `make lint` passes
</verification>

<success_criteria>
- run_refactored_pipeline renamed to run_pipeline everywhere (source + tests)
- pipeline.py docstring describes stage-based pipeline without "refactored" language
- main() demo function removed from pipeline.py
- All tests pass with no behavioral changes
</success_criteria>

<output>
After completion, create `.planning/phases/29-classic-pipeline-deprecation-and-removal/29-01-SUMMARY.md`
</output>
