---
phase: 38-codebase-cleanup
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - variantcentrifuge/stages/__init__.py
  - variantcentrifuge/pipeline_core/runner.py
autonomous: true

must_haves:
  truths:
    - "__all__ in stages/__init__.py lists all public stage classes including the 6 missing ones"
    - "TODO intelligent batching in runner.py is replaced with a deferred-work note"
  artifacts:
    - path: "variantcentrifuge/stages/__init__.py"
      provides: "Complete __all__ exports"
      contains: "AssociationAnalysisStage"
    - path: "variantcentrifuge/pipeline_core/runner.py"
      provides: "No TODO for intelligent batching"
  key_links: []
---

<objective>
Apply minor code cleanup: add missing stage exports to __init__.py and resolve the TODO intelligent batching comment in runner.py.

Purpose: Complete the minor housekeeping items that improve code discoverability and remove misleading TODOs.
Output: Clean __init__.py exports and resolved TODO comments.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/38-codebase-cleanup/38-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add missing __all__ exports and resolve TODO comments</name>
  <files>
    variantcentrifuge/stages/__init__.py
    variantcentrifuge/pipeline_core/runner.py
  </files>
  <action>
CLEAN-03: In `variantcentrifuge/stages/__init__.py`, read the current `__all__` list and add the 6 missing stage classes:
- `AssociationAnalysisStage`
- `ClinVarPM5Stage`
- `VariantAnalysisStage`
- `DataSortingStage`
- `ParallelCompleteProcessingStage`
- `PCAComputationStage`

Also add the corresponding imports if not already present. Check which module file each stage is defined in:
- `AssociationAnalysisStage` — likely in `analysis_stages.py`
- `ClinVarPM5Stage` — likely in `analysis_stages.py`
- `VariantAnalysisStage` — likely in `analysis_stages.py`
- `DataSortingStage` — likely in `processing_stages.py` or `output_stages.py`
- `ParallelCompleteProcessingStage` — likely in `processing_stages.py`
- `PCAComputationStage` — likely in `analysis_stages.py`

Verify each import works by checking the class exists in the target module (grep for `class XxxStage`).

CLEAN-06: In `variantcentrifuge/pipeline_core/runner.py` line 725, replace the TODO comment about intelligent batching with a deferred-work note:
```python
# NOTE: Intelligent batching deferred — current fixed-size batching is sufficient
# for observed workloads. Revisit if stage count exceeds ~100.
```
Keep the method body unchanged (it's called at line 660 and works fine).
  </action>
  <verify>
Run: `python -c "from variantcentrifuge.stages import AssociationAnalysisStage, ClinVarPM5Stage, VariantAnalysisStage, DataSortingStage, ParallelCompleteProcessingStage, PCAComputationStage; print('All imports OK')"` — should print "All imports OK".
Run: `grep -n "TODO.*intelligent" variantcentrifuge/pipeline_core/runner.py` — should return nothing.
Run: `make ci-check` — passes clean.
  </verify>
  <done>All 6 missing stages are exported from stages/__init__.py and importable. TODO intelligent batching replaced with deferred-work note. `make ci-check` passes.</done>
</task>

</tasks>

<verification>
1. All 6 stage classes importable from `variantcentrifuge.stages`
2. No TODO for intelligent batching in runner.py
3. `make ci-check` passes
</verification>

<success_criteria>
- `__all__` in stages/__init__.py is complete with all public stage classes
- TODO intelligent batching resolved with deferred note
- `make ci-check` passes clean
</success_criteria>

<output>
After completion, create `.planning/phases/38-codebase-cleanup/38-03-SUMMARY.md`
</output>
